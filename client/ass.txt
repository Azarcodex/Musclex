const [selectedCategory, setSelectedCategory] = useState([]);
const [selectedBrands, setSelectedBrands] = useState([]);
const [priceRange, setPriceRange] = useState([0, 60000]);
const [selectedRatings, setSelectedRatings] = useState([]);
const [sortValue, setSortValue] = useState("");

// pagination
const [page, setPage] = useState(1);

// redux search
const { query } = useSelector((state) => state.search);
const [debounce, setDebounce] = useState(query);

/* -------------------------------
   DEBOUNCE SEARCH
-------------------------------- */
useEffect(() => {
  const timeout = setTimeout(() => {
    setDebounce(query);
  }, 500);

  return () => clearTimeout(timeout);
}, [query]);

/* -------------------------------
   RESET PAGE WHEN FILTERS CHANGE
-------------------------------- */
useEffect(() => {
  setPage(1);
}, [
  selectedCategory,
  selectedBrands,
  priceRange,
  selectedRatings,
  sortValue,
  debounce,
]);

/* -------------------------------
   FETCH PRODUCTS (NORMAL)
-------------------------------- */
const {
  data: productData,
  isPending: isProductLoading,
} = useProductFetch(
  page,
  selectedCategory,
  selectedBrands,
  priceRange,
  selectedRatings,
  sortValue,
  debounce // optional if backend supports search
);

/* -------------------------------
   FETCH SEARCH RESULTS
-------------------------------- */
const {
  data: searchData,
  isPending: isSearchLoading,
} = useSearch(debounce, {
  enabled: !!debounce, // ðŸ”¥ IMPORTANT
});

/* -------------------------------
   DECIDE DATA SOURCE
-------------------------------- */
const data = debounce ? searchData : productData;
const isLoading = debounce ? isSearchLoading : isProductLoading;

/* -------------------------------
   LOADING UI
-------------------------------- */
if (isLoading) {
  return (
    <div className="min-h-screen flex flex-col">
      <div className="flex-1 flex items-center justify-center">
        <div className="flex flex-col items-center gap-4">
          <div className="h-14 w-14 rounded-full border-4 border-purple-200 border-t-purple-600 animate-spin"></div>
          <p className="text-gray-500 text-sm">Loading products...</p>
        </div>
      </div>
      <Footer />
    </div>
  );
}

/* -------------------------------
   PAGINATION DATA (SAFE)
-------------------------------- */
const totalPages = data?.pagination?.totalPages || 1;
const totalProducts = data?.pagination?.totalProducts || 0;
const current = data?.pagination?.current || page;

/* -------------------------------
   PAGINATION HANDLERS
-------------------------------- */
const handleNext = () => {
  if (page < totalPages) setPage((prev) => prev + 1);
};

const handlePrev = () => {
  if (page > 1) setPage((prev) => prev - 1);
};
